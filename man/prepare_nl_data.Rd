% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/nestlogit_utils.R
\name{prepare_nl_data}
\alias{prepare_nl_data}
\title{Prepare inputs for nested logit estimation}
\usage{
prepare_nl_data(
  data,
  id_col,
  alt_col,
  choice_col,
  covariate_cols,
  nest_col,
  weights = NULL,
  outside_opt_label = NULL,
  include_outside_option = FALSE
)
}
\arguments{
\item{data}{Data frame containing choice data.}

\item{id_col}{Name of the column identifying choice situations (individuals).}

\item{alt_col}{Name of the column identifying alternatives.}

\item{choice_col}{Name of the column indicating chosen alternative (1 = chosen, 0 = not chosen).}

\item{covariate_cols}{Vector of names of columns to be used as covariates.}

\item{nest_col}{Name of the column mapping each alternative to its nest.
Every alternative must belong to exactly one nest.}

\item{weights}{Optional vector of weights for each choice situation. If \code{NULL}, equal weights are used.}

\item{outside_opt_label}{Label for the outside option (if any). If \code{NULL}, no outside option is assumed.}

\item{include_outside_option}{Logical indicating whether to include an outside option in the model.}
}
\value{
A \code{choicer_data_nl} object (list) containing:
\itemize{
\item All fields from \code{\link{prepare_mnl_data}} (\code{X}, \code{alt_idx},
\code{choice_idx}, \code{M}, \code{N}, \code{weights}, \code{include_outside_option},
\code{alt_mapping}, \code{dropped_cols}).
\item \code{nest_idx}: Integer vector of length J mapping each alternative
(in \code{alt_mapping} row order) to its nest.
\item \code{data_spec}: List with column name metadata including \code{nest_col}.
}
}
\description{
Validates inputs, builds design matrices, and constructs nest structure
for nested logit estimation. Calls \code{\link{prepare_mnl_data}} internally
for base data preparation, then adds nest-specific fields.
}
\examples{
library(data.table)
set.seed(42)
N <- 50; J <- 4
dt <- data.table(id = rep(1:N, each = J), alt = rep(1:J, N))
dt[, `:=`(x1 = rnorm(.N), x2 = rnorm(.N))]
dt[, nest := ifelse(alt <= 2, "A", "B")]
dt[, choice := 0L]
dt[, choice := sample(c(1L, rep(0L, J - 1))), by = id]
input <- prepare_nl_data(dt, "id", "alt", "choice", c("x1", "x2"), "nest")
input$nest_idx
input$alt_mapping
}
