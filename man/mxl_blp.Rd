% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mxlogit_utils.R
\name{mxl_blp}
\alias{mxl_blp}
\title{BLP contraction mapping for mixed logit}
\usage{
mxl_blp(
  delta_init,
  target_shares,
  input_data,
  beta,
  mu,
  L_params,
  eta_draws,
  rc_dist,
  rc_mean = FALSE,
  tol = 1e-08,
  max_iter = 1000
)
}
\arguments{
\item{delta_init}{Initial guess for delta (ASC) values. Should be J-1 elements
if \code{include_outside_option = FALSE}, or J elements if \code{include_outside_option = TRUE}.}

\item{target_shares}{Target market shares. Must have J elements (including
outside option if applicable).}

\item{input_data}{List output from \code{prepare_mxl_data()}.}

\item{beta}{Fixed coefficients vector (K_x elements).}

\item{mu}{Mean parameters for random coefficients (K_w elements). Use zeros
if \code{rc_mean = FALSE}.}

\item{L_params}{Cholesky parameters vector. Length is K_w * (K_w + 1) / 2 if
\code{rc_correlation = TRUE}, or K_w if \code{rc_correlation = FALSE}.}

\item{eta_draws}{Array of shape K_w x S x N with standard normal draws.}

\item{rc_dist}{Integer vector indicating distribution (0 = normal, 1 = log-normal).}

\item{rc_mean}{Logical indicating whether means are estimated for random coefficients.}

\item{tol}{Convergence tolerance. Default is 1e-8.}

\item{max_iter}{Maximum number of iterations. Default is 1000.}
}
\value{
Converged delta (ASC) vector. Length is J-1 if \code{include_outside_option = FALSE},
or J if \code{include_outside_option = TRUE}.
}
\description{
Finds the ASC (delta) parameters such that predicted market shares
match target shares, using the contraction mapping of Berry, Levinsohn,
and Pakes (1995). This is useful for demand estimation and counterfactual
simulations.
}
\examples{
\donttest{
library(data.table)
set.seed(42)
N <- 100; J <- 3
dt <- data.table(id = rep(1:N, each = J), alt = rep(1:J, N))
dt[, `:=`(x1 = rnorm(.N), w1 = rnorm(.N))]
dt[, choice := 0L]
dt[, choice := sample(c(1L, rep(0L, J - 1))), by = id]
input <- prepare_mxl_data(dt, "id", "alt", "choice", "x1", "w1")
eta <- get_halton_normals(50, input$N, ncol(input$W))
fit <- run_mxlogit(input_data = input, eta_draws = eta)
pm <- fit$param_map
delta <- mxl_blp(
  delta_init = rep(0, J), target_shares = rep(1/J, J),
  input, beta = coef(fit)[pm$beta], mu = rep(0, ncol(input$W)),
  L_params = coef(fit)[pm$sigma], eta, rc_dist = rep(0L, ncol(input$W))
)
}
}
